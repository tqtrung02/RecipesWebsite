<% if (!user) { %> <!-- Check if the user is not logged in -->
    <div class="alert alert-warning text-center">
        <h4>Vui lòng <a href="/login">Đăng nhập</a> để sửa công thức của bạn!</h4>
    </div>
<% } else { %> <!-- Show the recipe editing form if logged in -->
    <div class="px-4 py-5 my-5 text-center">
        <h1 class="display-5 fw-bold">Sửa công thức của bạn</h1>
        <img src="/img/—Pngtree—recipe book vector_12159143.png" alt="Recipe Image" width="400" height="300">
        <div class="col-lg-6 mx-auto">
            <p class="lead">Chỉnh sửa công thức nấu ăn của bạn. Điền vào biểu mẫu dưới đây để cập nhật công thức!</p>
        </div>
    </div>

    <div class="row justify-content-center">
      <% if (infoSubmit && infoSubmit.length > 0) { %>
          <div class="col-8 alert alert-success" role="alert">
              <%= infoSubmit[0] %>
          </div>
      <% } %>
      
      <% if (infoError && infoError.length > 0) { %>
          <div class="col-8 alert alert-danger" role="alert">
              <%= infoError[0] %>
          </div>
      <% } %>

      <div class="col-8">
          <form action="/recipe/edit/<%= recipe._id %>" enctype="multipart/form-data" method="POST">
              <div class="row g-3">
                  <div class="col-12">
                      <label for="name" class="form-label">Tên công thức</label>
                      <input type="text" name="name" id="name" class="form-control" value="<%= recipe.name %>" required>
                  </div>

                  <div class="col-12">
                      <label for="description" class="form-label">Mô tả</label>
                      <textarea name="description" id="description" class="form-control" cols="30" rows="4"><%= recipe.description %></textarea>
                  </div>

                  <!-- Ingredients Field -->
                  <div class="col-12">
                      <label for="ingredients" class="form-label">Nguyên liệu</label>
                      <small>Ví dụ: Muối</small>
                      <div class="ingredientList">
                          <% recipe.ingredients.forEach(function(ingredient, index) { %>
                            <div class="ingredientDiv mb-1 position-relative">
                                <input type="text" name="ingredients" class="form-control ps-3 pe-5" value="<%= ingredient %>" required>
                                <button type="button" class="btn btn-link text-danger position-absolute top-50 end-0 translate-middle-y" onclick="removeIngredient(this)">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                          <% }); %>
                      </div>
                  </div>

                  <div class="col-12">
                      <button type="button" class="btn btn-outline-primary" id="addIngredientsBtn">+ Nguyên liệu</button>
                  </div>

                  <div class="col-12">
                      <label for="category">Chọn danh mục</label>
                      <select class="form-select form-control" name="category" aria-label="Category">
                          <option selected><%= recipe.category %></option>
                          <option value="Thái">Món Thái</option>
                          <option value="Mỹ">Món Mỹ</option>
                          <option value="Trung">Món Trung</option>
                          <option value="Mê-hi-cô">Món Mê-hi-cô</option>
                          <option value="Ấn Độ">Món Ấn Độ</option>
                          <option value="Tây Ban Nha">Món Tây Ban Nha</option>
                          <option value="Việt">Món Việt</option>
                      </select>
                  </div>

                  <div class="col-12">
                      <label for="image">Hình ảnh</label>
                      <input type="file" class="form-control" name="image" accept="image/*">
                      <img src="/uploads/<%= recipe.image %>" alt="<%= recipe.name %>" class="img-thumbnail mt-2" width="200">
                  </div>

                  <div class="col-12">
                      <button type="submit" class="btn btn-primary">Cập nhật công thức</button>
                  </div>
              </div>
          </form>
      </div>
    </div>
<% } %>